<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gabriel">
<meta name="dcterms.date" content="2026-01-27">
<meta name="description" content="Analyzing 17 years of TOTO draw data to determine if lottery numbers can be predicted and whether the house always wins">

<title>Can You Beat TOTO? A Statistical Analysis of Singapore’s National Lottery – Gabriel's Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Gabriel’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../adroitly.html"> 
<span class="menu-text">Adroitly Consulting</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#toto-analysis" id="toc-toto-analysis" class="nav-link active" data-scroll-target="#toto-analysis">TOTO Analysis</a></li>
  <li><a href="#toto-lottery-rules-how-to-pray-play" id="toc-toto-lottery-rules-how-to-pray-play" class="nav-link" data-scroll-target="#toto-lottery-rules-how-to-pray-play">TOTO lottery rules: how to <del>pray</del> play</a>
  <ul class="collapse">
  <li><a href="#prize-structure" id="toc-prize-structure" class="nav-link" data-scroll-target="#prize-structure">Prize Structure</a></li>
  </ul></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The Data</a></li>
  <li><a href="#what-we-want-to-investigate" id="toc-what-we-want-to-investigate" class="nav-link" data-scroll-target="#what-we-want-to-investigate">What We Want to Investigate</a></li>
  <li><a href="#how-to-predict-toto-draws" id="toc-how-to-predict-toto-draws" class="nav-link" data-scroll-target="#how-to-predict-toto-draws">How to Predict TOTO Draws</a>
  <ul class="collapse">
  <li><a href="#probability-of-winning" id="toc-probability-of-winning" class="nav-link" data-scroll-target="#probability-of-winning">Probability of Winning</a></li>
  <li><a href="#expected-value-of-winning" id="toc-expected-value-of-winning" class="nav-link" data-scroll-target="#expected-value-of-winning">Expected Value of Winning</a></li>
  <li><a href="#hot-and-cold-numbers" id="toc-hot-and-cold-numbers" class="nav-link" data-scroll-target="#hot-and-cold-numbers">Hot and Cold Numbers</a></li>
  <li><a href="#but-wait-i-have-a-system" id="toc-but-wait-i-have-a-system" class="nav-link" data-scroll-target="#but-wait-i-have-a-system">But wait, I have a SYSTEM!</a></li>
  </ul></li>
  <li><a href="#does-the-house-always-win" id="toc-does-the-house-always-win" class="nav-link" data-scroll-target="#does-the-house-always-win">Does the House Always Win?</a>
  <ul class="collapse">
  <li><a href="#loss-conditions-for-singapore-pools" id="toc-loss-conditions-for-singapore-pools" class="nav-link" data-scroll-target="#loss-conditions-for-singapore-pools">Loss Conditions for Singapore Pools</a>
  <ul class="collapse">
  <li><a href="#conditions-for-weak-loss" id="toc-conditions-for-weak-loss" class="nav-link" data-scroll-target="#conditions-for-weak-loss">Conditions for “Weak” Loss</a></li>
  <li><a href="#historical-occurrences-of-weak-loss" id="toc-historical-occurrences-of-weak-loss" class="nav-link" data-scroll-target="#historical-occurrences-of-weak-loss">Historical Occurrences of “Weak” Loss</a></li>
  <li><a href="#conditions-for-strong-loss" id="toc-conditions-for-strong-loss" class="nav-link" data-scroll-target="#conditions-for-strong-loss">Conditions for “Strong” Loss</a></li>
  </ul></li>
  <li><a href="#so-when-does-the-house-lose" id="toc-so-when-does-the-house-lose" class="nav-link" data-scroll-target="#so-when-does-the-house-lose">So, When Does the House Lose?</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Can You Beat TOTO? A Statistical Analysis of Singapore’s National Lottery</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Data Analysis</div>
    <div class="quarto-category">Statistics</div>
    <div class="quarto-category">Probability</div>
    <div class="quarto-category">Singapore</div>
  </div>
  </div>

<div>
  <div class="description">
    Analyzing 17 years of TOTO draw data to determine if lottery numbers can be predicted and whether the house always wins
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gabriel </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 27, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/title_image.png" class="img-fluid figure-img"></p>
<figcaption><em>credit: Nano Banana</em></figcaption>
</figure>
</div>
<section id="toto-analysis" class="level1">
<h1>TOTO Analysis</h1>
<p>With AI coming for our jobs and the risk of rising inflation, making decent money is becoming a tougher challenge with each passing year. In these tumultuous times, the desperate look to the heavens for a miracle - the miracle of winning the lottery! As a Singaporean, that means praying at the foot of the temple of TOTO, our national lottery boasting cash payouts of up to $13 million thus far.</p>
<p>In this post, we analyse the lottery draws of TOTO to determine if it can be predicted (it can’t), and find out if the house (or TOTO temple, or Tote board) always wins.</p>
</section>
<section id="toto-lottery-rules-how-to-pray-play" class="level1">
<h1>TOTO lottery rules: how to <del>pray</del> play</h1>
<p>TOTO is a 6 out of 49 Lotto-style game, with 1 additional number. A single $1 lottery ticket allows you to pick 6 numbers with no repeats, from a range of 1 to 49 inclusive. During the draw, a total of 7 numbers are drawn - prizes are paid out depending on how many numbers on your ticket matches the numbers of the draw (and number order does not matter).</p>
<section id="prize-structure" class="level2">
<h2 class="anchored" data-anchor-id="prize-structure">Prize Structure</h2>
<p>TOTO distinguishes the first 6 numbers from the 7th additional number for the purposes of prize payouts. Here is the prize structure, direct from Singapore Pools (TOTO’s managing organisation).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image.png" class="img-fluid figure-img"></p>
<figcaption>Prize structure table from Singapore Pools</figcaption>
</figure>
</div>
<p>Note that Groups 1 to 4 receive a payout that is a percentage of the Prize Pool, while Groups 5 to 7 receive a fixed payout.</p>
<p>Also note that Groups 1 to 4 benefit from “snowballing”, in which un-won prize money from previous draws are rolled over to the current draw (limited to 4 rollovers).</p>
<p>Finally, note that Group 1’s jackpot payout is guaranteed by Singapore Pools to payout a minimum of $1,000,000. The top-up of the prize amount will come from Singapore Pools’ own pocket.</p>
</section>
</section>
<section id="the-data" class="level1">
<h1>The Data</h1>
<p>To inform our analysis, 15 years of data comprising 1808 draws were obtained from <a href="https://en.lottolyzer.com/history/singapore/toto/">this website</a>. Cursory data validation was performed by checking the two most recent draws against TOTO’s website, which I had bought tickets “for research”.</p>
<p>Since the TOTO rules were updated from “6 out-of 45” to a “6 out-of 49” format in October 2014, this gives us 1154 useable draws in the current format.</p>
<p>The data contains the 6+1 draw numbers, as well as prize amount and number of winners for each of the 7 prize groups.</p>
</section>
<section id="what-we-want-to-investigate" class="level1">
<h1>What We Want to Investigate</h1>
<p>With the dataset, we can attempt to answer two questions:</p>
<ol type="1">
<li>Can we win money by predicting the next draw of winning numbers?</li>
<li>Even if we don’t win, does “the house always win”?</li>
</ol>
</section>
<section id="how-to-predict-toto-draws" class="level1">
<h1>How to Predict TOTO Draws</h1>
<p><strong>Spoiler Alert:</strong> You can’t. But the real fun is in understanding why, and accepting your fate, right?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 1.png" class="img-fluid figure-img"></p>
<figcaption>Look how excited the TOTO announcer is to inform you that you lost money! <em>credit: Singapore Pools YouTube</em></figcaption>
</figure>
</div>
<section id="probability-of-winning" class="level2">
<h2 class="anchored" data-anchor-id="probability-of-winning">Probability of Winning</h2>
<p>As a risk averse (i.e.&nbsp;kiasu) Singaporean, I want to play the game knowing my chances. So lets math it out. Here we will make heavy use of the binomial coefficient formula to determine how many combinations are possible when picking <span class="math inline">\(r\)</span> numbers from a set of <span class="math inline">\(n\)</span> numbers. The formula is:</p>
<p><span class="math display">\[
C(n,r)=\frac{n\times(n-1)\times  \dots\times (n-r+1)}{r \times (r-1) \times \dots  \times 1}
\]</span></p>
<p>The number of combinations for a single TOTO ticket of six numbers is <span class="math inline">\(C(49,6)=13,983,816\)</span>.</p>
<p>With reference to the prize structure table above, lets calculate the number of combinations to win Group 7. First you would need to match three of the six winning numbers, so <span class="math inline">\(C(6,3)=20\)</span>. Then not match the additional number, so <span class="math inline">\(C(1,0)=1\)</span>. You still have to fill your ticket with three more numbers, which can be any combination of the 42 remaining undrawn numbers, so <span class="math inline">\(C(42,3)=11,480\)</span>. Hence, the number of ways you can win Group 7 is:</p>
<p><span class="math display">\[
\text{Number of Ways to Win Group 7} = C(6,3)\times C(1,0) \times C(42,3)=229,600
\]</span></p>
<p>The probability of winning Group 7 is the number of ways to win it divided by the total possible ways to form a TOTO ticket, so <span class="math inline">\(229600/13983816 = 1.64\%\)</span></p>
<p>Lets do the same calculation for all the prize groups.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Group</th>
<th>Number of Ways to Win the Group</th>
<th>Probability <span class="math inline">\(P(Win_i)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><span class="math inline">\(C(6,6)\times C(1,0) \times C(42,0)=1\)</span></td>
<td>0.000007 %</td>
</tr>
<tr class="even">
<td>2</td>
<td><span class="math inline">\(C(6,5)\times C(1,1) \times C(42,0)=6\)</span></td>
<td>0.00004 %</td>
</tr>
<tr class="odd">
<td>3</td>
<td><span class="math inline">\(C(6,5)\times C(1,0) \times C(42,1)=252\)</span></td>
<td>0.0018 %</td>
</tr>
<tr class="even">
<td>4</td>
<td><span class="math inline">\(C(6,4)\times C(1,1) \times C(42,1)=630\)</span></td>
<td>0.0045 %</td>
</tr>
<tr class="odd">
<td>5</td>
<td><span class="math inline">\(C(6,4)\times C(1,0) \times C(42,2)=12915\)</span></td>
<td>0.0924 %</td>
</tr>
<tr class="even">
<td>6</td>
<td><span class="math inline">\(C(6,3)\times C(1,1) \times C(42,2)=17220\)</span></td>
<td>0.1231 %</td>
</tr>
<tr class="odd">
<td>7</td>
<td><span class="math inline">\(C(6,3)\times C(1,0) \times C(42,3)=229600\)</span></td>
<td>1.6419 %</td>
</tr>
</tbody>
</table>
<p>Summing the probabilities, the chance of winning any prize is approximately 1.84%. That’s only marginally better than flipping a coin and getting tails six times in a row.</p>
</section>
<section id="expected-value-of-winning" class="level2">
<h2 class="anchored" data-anchor-id="expected-value-of-winning">Expected Value of Winning</h2>
<p>Okay, but even if the odds are small, we should keep playing because the payouts are big, right?</p>
<p>We can calculate the expected value for Groups 5 to 7 easily, since they have fixed payouts of $50 to $10. For Group 7,</p>
<p><span class="math inline">\(\mathbb{E}[Payout_7]=P(Win_7) \times Prize_7 = 0.016419 \times \$10 = \$0.16\)</span></p>
<p>What about Groups 1 to 4, with a variable prize which is a percentage of the total prize pool? First, we must recognise that:</p>
<ol type="1">
<li>The prize pool is 54.5% of the total sales $<span class="math inline">\(N\)</span> (more on this later)</li>
<li>One ticket is $1</li>
</ol>
<p>Let the percentage of the prize pool for group <span class="math inline">\(i\)</span> be <span class="math inline">\(Pct_i\)</span>, then</p>
<p><span class="math inline">\(\mathbb{E}[Payout_i] = P(Win_i)\times \mathbb{E}[Prize_i]\)</span></p>
<p><span class="math inline">\(\mathbb{E}[Payout_i] = P(Win_i)\times \frac{N\times 0.545\times Pct_i}{N \times P(Win_i)}\)</span></p>
<p><span class="math inline">\(\mathbb{E}[Payout_i] = 0.545 \times Pct_i\)</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Group</th>
<th>Probability</th>
<th><span class="math inline">\(\mathbb{E}[Payout_i]\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.000007 %</td>
<td>$0.2071</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.00004 %</td>
<td>$0.0436</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.0018 %</td>
<td>$0.0300</td>
</tr>
<tr class="even">
<td>4</td>
<td>0.0045 %</td>
<td>$0.0164</td>
</tr>
<tr class="odd">
<td>5</td>
<td>0.0924 %</td>
<td>$0.0462</td>
</tr>
<tr class="even">
<td>6</td>
<td>0.1231 %</td>
<td>$0.0308</td>
</tr>
<tr class="odd">
<td>7</td>
<td>1.6419 %</td>
<td>$0.1642</td>
</tr>
</tbody>
</table>
<p>And so the expected value of winning any group is $0.54. Statistically speaking, if you totalled your profits and losses across your natural lifetime, you would only get back 54% of what you put in. Ouch. But what if - like my dear grandmother - you had a system for picking those TOTO numbers? Could you “beat the odds”?</p>
</section>
<section id="hot-and-cold-numbers" class="level2">
<h2 class="anchored" data-anchor-id="hot-and-cold-numbers">Hot and Cold Numbers</h2>
<p>One method of picking TOTO numbers is based off the frequency they are drawn. Some people think numbers that occur more frequently will continue to occur frequently (hot), while others think numbers that occur less frequently are due to appear soon (cold).</p>
<p><strong>But what is “more” or “less” frequent?</strong></p>
<p>To determine if a number occurs more or less frequently, we have to compare it to some expected frequency. Lets work out what this expected frequency is.</p>
<p>For a number <span class="math inline">\(i\)</span>, the probability of <span class="math inline">\(i\)</span> being drawn is <span class="math inline">\(P(i \text{ is drawn}) = 7/49\)</span>, because there are 7 chances to draw a number, and there are 49 TOTO numbers. There are two possible outcomes for the number <span class="math inline">\(i\)</span>, drawn or not drawn. This means that each number follows a binomial distribution.</p>
<p>Through careful inspection of the 49 balls in the cool glass contraption in the image above, we can hypothesize that each number is equally likely to be drawn. Furthermore, picking a number <span class="math inline">\(i\)</span> does not affect the probability of picking a number <span class="math inline">\(j\)</span>, so all 49 TOTO numbers are <em>independently and identically distributed</em> <em>(i.i.d).</em></p>
<p>For a binomial distribution, the average or expected frequency is <span class="math inline">\(np\)</span>, where <span class="math inline">\(n\)</span> is the number of TOTO lottery draws (1154 in our dataset), and <span class="math inline">\(p = P(i \text{ is drawn}) = 7/49\)</span>. Then the expected frequency is:</p>
<p><span class="math display">\[
\mathbb{E}[i \text{ is drawn in dataset}] = np = 1154\times 7/49=164.86
\]</span></p>
<p>Lets see what the data shows.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 2.png" class="img-fluid figure-img"></p>
<figcaption>Number frequency distribution showing hot and cold numbers</figcaption>
</figure>
</div>
<p>Here we see a plot for all 49 TOTO numbers on the horizontal axis, and the number of occurrences on the vertical axis. The red horizontal line depicts the expected number of occurrences for the dataset (164.86). Hot numbers appear above the line, Cold numbers appear below the line.</p>
<p>The top 6 hottest and coldest numbers are labelled for you lucky cats out there.</p>
<p><strong>Is the data statistically significant?</strong></p>
<p>Before you rush off to dump your life savings into the next TOTO draw, lets check whether the variation we are seeing could be explainable by the variance in the underlying probability distribution. The variance of a binomial distribution is calculated as:</p>
<p><span class="math display">\[
Var[i\text{ is drawn in dataset}] = np(1-p) = 1154 \times 7/49 \times 42/49 = 141.3
\]</span></p>
<p>And the standard deviation is thus <span class="math inline">\(\sigma_n=\sqrt{141.3}=11.88\)</span>. For the “hottest” TOTO number 15 appearing 189 times in the dataset means that it is <span class="math inline">\((189-164.86)/11.88 = 2.03\sigma\)</span>, or approximately 2 standard deviations from the mean.</p>
<p>In other words, if a TOTO number truly does follow a binomial distribution (and the number of TOTO draws is large like in our dataset here), then we would expect occurrences of <span class="math inline">\(2\sigma\)</span> to appear approximately 5% of the time, or 2 to 3 of the 49 TOTO numbers. Indeed, the data shows TOTO numbers 15 and 45 are the two numbers that deviate by <span class="math inline">\(\geq2\sigma\)</span>.</p>
<p><strong>Doubling Down… on Math</strong></p>
<p>“But wait!” you say, putting your TOTO tickets aside for a moment. “That’s just back-of-the-envelope math, and all I have is this TOTO ticket to scribble on! Maybe there are other hot or cold numbers?”</p>
<p>You’re right, we’ve only looked at the hottest and coldest numbers so far. A complementary check we could perform would be the Chi-Square Test, denoted by the formula</p>
<p><span class="math display">\[
\chi^2 = \sum_{i=1}^{49}\frac{(o_i - e_i)^2}{e_i}
\]</span></p>
<p>Where <span class="math inline">\(o_i\)</span> and <span class="math inline">\(e_i\)</span> are the observed and expected number of occurrences for the TOTO number <span class="math inline">\(i\)</span> respectively.</p>
<p>While previously we were looking at individual outlying TOTO numbers, here the Chi-Square test checks all 49 TOTO numbers to see if each and every TOTO number follows a binomial distribution. More specifically, the value of <span class="math inline">\(\chi^2\)</span> represents the sum of deviations from the expected occurrences, which can be checked against the Chi-Square distribution to obtain the probability that all TOTO numbers have a fair chance of being drawn (which we call the null hypothesis).</p>
<p>From calculation, <span class="math inline">\(\chi^2=32.73\)</span>, and with <span class="math inline">\(49-1=48\)</span> degrees of freedom, the p-value obtained is <span class="math inline">\(95.48\%\)</span> (probability of the dataset representing samples of a fair TOTO draw).</p>
<p>Unfortunately, the data shows that TOTO is <strong>very likely not rigged</strong>, and every TOTO number has an equally likely probability of occurring<strong>.</strong></p>
<p><strong>A Slight Detour into Psychology</strong></p>
<p>Gambling is interesting to me because its analysis sits at the intersection of math and psychology. This perception of hot and cold numbers has been comprehensively documented under the term “<a href="https://en.wikipedia.org/wiki/Gambler%27s_fallacy">The Gambler’s Fallacy</a>”. The little voice in our head insisting that previously absent numbers should appear soon suggests some link between previous TOTO draws and current ones. That the mathematical reality is that each draw is independent from past and future draws also requires some manner of belief; in the infallible logic of math.</p>
</section>
<section id="but-wait-i-have-a-system" class="level2">
<h2 class="anchored" data-anchor-id="but-wait-i-have-a-system">But wait, I have a SYSTEM!</h2>
<p>We’ve already shown that the TOTO game is mathematically fair, with strong evidence from the 15 years of historical results. That does not mean that TOTO is impossible to win, merely that any combination of six TOTO numbers are equally likely to win. And for some people, spending a dollar to “buy hope” (买希望 in mandarin) is still worth it. Lets conclude this section with some data visualisation. Instead of letting the TOTO system pick numbers for you at random, maybe you can use the figure below to pick for yourself. But really, I just want to show you some colourful plots I made.</p>
<p>The system I propose is based on co-occurrence, and is detailed as follows:</p>
<ol type="1">
<li>Starting from a hand-picked initial number <span class="math inline">\(a\)</span>, you find the most commonly paired number <span class="math inline">\(b\)</span>.</li>
<li>From <span class="math inline">\(b\)</span>, find the next most commonly paired number <span class="math inline">\(c\)</span>.</li>
<li>Repeat until you get all six numbers for your TOTO ticket</li>
<li>Profit???</li>
</ol>
<p>Lets first visualise the co-occurrences of every pair of numbers in a heatmap plot. The plot is symmetrical about its diagonal, because the number of occurrences for TOTO number pair <span class="math inline">\((a,b)\)</span> is the same as pair <span class="math inline">\((b,a)\)</span>. The diagonal for pair <span class="math inline">\((a,a)\)</span> is ignored and arbitrarily set to 0. Green boxes indicate pairs that are drawn frequently, while red boxes indicate rarely drawn pairs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 3.png" class="img-fluid figure-img"></p>
<figcaption>Heatmap of co-occurrence between TOTO number pairs</figcaption>
</figure>
</div>
<p>We should also note that all pairs have been seen at least once. The actual co-occurrence ranges from 9 to 40.</p>
<p>The heatmap contains useful information, but is difficult to read in detail. We can visualise it as a network graph, with each node representing a single TOTO number. Connections (i.e.&nbsp;edges) between the TOTO numbers represent pairs, and the closer the nodes are to each other, the more frequently the corresponding pairs occur in the dataset. The larger the node, the more connections it has.</p>
<p><em>Note that we are only displaying the top 20% of edges, because the graph is fully connected and the visualisation would be really challenging to read otherwise.</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 4.png" class="img-fluid figure-img"></p>
<figcaption>Network graph showing TOTO number co-occurrence relationships</figcaption>
</figure>
</div>
<p>Now we are ready to pick numbers. Starting from your favourite number, traverse the network until you get all six TOTO numbers on your ticket. If you selected each node based on node size, this means you now have the most historically frequent set of numbers which also include your favourite number!</p>
<p><em>Reminder: past performance does not guarantee future performance, and this system is by no means mathematically optimal. Although if you do win, please consider buying me a coffee (with a sprinkling of gold flakes and diamonds in it).</em></p>
</section>
</section>
<section id="does-the-house-always-win" class="level1">
<h1>Does the House Always Win?</h1>
<p>Its interesting how games of chance are designed in a way to give gamblers a sense of hope (and maybe some measure of control) in securing a win, and yet casinos in Vegas are sitting on actual piles of cash year after year. Singapore Pools is no different, with $575M in contributions to the Tote Board for the 2025 financial year. Since the Tote Board collects “surplus” from Singapore Pools, lets just call this their net profit for the year. That’s a pretty hefty sum by most accounts.</p>
<p>So how does Singapore Pools do it? Its pretty blatant actually - here’s a screenshot from the official TOTO Game Rules:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 5.png" class="img-fluid figure-img"></p>
<figcaption>TOTO game rules showing 54.5% prize pool allocation</figcaption>
</figure>
</div>
<p>Simply put, only 54.5% of collected TOTO ticket sales is channelled into the prize pool. Singapore Pools skims 45.5% right off the top before the draw! Here’s a Sankey diagram, which also depicts the payouts for each group.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sankey_diagram.png" class="img-fluid figure-img"></p>
<figcaption>Sankey diagram showing TOTO sales flow and prize payouts</figcaption>
</figure>
</div>
<p>Is there any hope for the little guy out there? ****Even if we don’t win, <strong>is there a way to ensure mutual destruction by having Singapore Pools lose money</strong>? That’s what we’re here to find out, with the help of math.</p>
<section id="loss-conditions-for-singapore-pools" class="level2">
<h2 class="anchored" data-anchor-id="loss-conditions-for-singapore-pools">Loss Conditions for Singapore Pools</h2>
<p>Lets first define losses to Singapore Pools, then we can find the conditions in which they occur.</p>
<p><strong>Definition 1:</strong> For a given TOTO draw, the total payouts exceed the allotted 54.5% of total sales. This is the “weak” version of loss, since it just means Singapore Pools obtains less income for that draw.</p>
<p><strong>Definition 2:</strong> For a given TOTO draw, the total payouts exceed total sales. This is the “strong” version of loss, since Singapore Pools experienced negative income and would have to dig into their treasury to service the payouts owed to the ticket winners.</p>
<section id="conditions-for-weak-loss" class="level3">
<h3 class="anchored" data-anchor-id="conditions-for-weak-loss">Conditions for “Weak” Loss</h3>
<p>Inspecting the TOTO rules, there are two scenarios in which Singapore Pools would suffer a weak loss. Some combination of these scenarios would be required for a weak loss per draw.</p>
<ol type="1">
<li>Ticket sales are so low for a draw that Singapore Pools have to top up the Group 1 prize in order to meet the minimum amount of <span class="math inline">\(1M. This occurs when\)</span> &lt; 10^6$ <span class="math inline">\((N\times 0.545) \times 0.38 &lt; 10^6\)</span> <span class="math inline">\(N &lt; 4,828,585 \text{ tickets}\)</span></li>
<li>The total (fixed amount) payouts for groups 5 to 7 exceed the allotted amount of 24.80% of total sales, requiring payouts taken from the 45.5% of total sales skimmed off for Singapore Pool’s income (this scenario assumes groups 1-4 are paid out as well). <span class="math inline">\(0.248 N &lt; Payout_{5,6,7} &lt; 0.703N\)</span></li>
</ol>
<p>Before we can analyse the data, we need to create the required features first. The dataset only provides Group <span class="math inline">\(i\)</span> payouts and number of winners - thankfully, we have sufficient information to find the ticket sales (i.e.&nbsp;the value of <span class="math inline">\(N\)</span>). Within the time range of the dataset, there has always been at least one winner in group 3, meaning the prize payouts have never been rolled over (“snowballed”). Knowing that group 3 is paidout 3% of total sales, we can find <span class="math inline">\(N=Prize_3 / 0.03\)</span>.</p>
</section>
<section id="historical-occurrences-of-weak-loss" class="level3">
<h3 class="anchored" data-anchor-id="historical-occurrences-of-weak-loss">Historical Occurrences of “Weak” Loss</h3>
<p><strong>Condition 1: Low Ticket Sales</strong></p>
<p>Now, lets see if condition 1 for weak loss has ever occurred in our dataset. In the following figure, we plot the total sales amount, compared against the $4.8M sales threshold where topup of group 1 prize is required.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 6.png" class="img-fluid figure-img"></p>
<figcaption>Ticket sales over time with $4.8M threshold indicated</figcaption>
</figure>
</div>
<p>In total, 12 draws were found that required topup. 10 of those draws occurred in the period of July to September 2020, which was the year when Singapore locked down for Covid-19. Looks like Singaporeans were sensible enough to prioritise their health over queueing for a TOTO ticket in those tumultuous times.</p>
<p>2 July 2020 marked the lowest total sales in the history of the updated game at only $4.05M. Singapore Pools had to topup $161K into the group 1 prize amount. (Unfortunately, no one won the group 1 prize on that draw)</p>
<p><strong>Condition 2: Many Group 5 to 7 Winners</strong></p>
<p>Since the prize pool is 54.5% of total sales, and groups 1 to 4 are allocated 54.5% of the prize pool, it follows that groups 5 to 7 are allocated the remaining 45.5% of the prize pool.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 7.png" class="img-fluid figure-img"></p>
<figcaption>Prize pool allocation between prize groups over time</figcaption>
</figure>
</div>
<p>From the dataset, 43% of the TOTO draws see Singapore Pools suffering a weak loss. In draws where Singapore Pools loses, we also see larger variance in the payouts, such as 2 May 2016 where group 5 to 7 payouts exceeded 90% of the total prize pool.</p>
<p>Interestingly, the average payouts for groups 5 to 7 across the dataset is 46.1% of the price pool, which is 0.6% above the allocated payout amount.</p>
<p><strong>Both Conditions Combined</strong></p>
<p>The actual impact of a weak loss can be measured when we assess both conditions as a whole. This is achieved by plotting the payouts for all groups as a percentage of total sales. With reference to the TOTO rules, Singapore Pools expects the sum of all payouts to be ≤54.5% of total sales.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 8.png" class="img-fluid figure-img"></p>
<figcaption>Total payouts as percentage of sales showing Singapore Pools win/loss ratio</figcaption>
</figure>
</div>
<p>Here we see that Singapore Pools win 61% of the draws (win meaning it takes more than the expected 54.5% as income), an increase from the 56% house-win rate from condition 2. This is likely due to the draws where groups 1 to 4 do not have any winners - the savings from not having to payout those larger prizes offsets the small-prize payouts of groups 5 to 7.</p>
<p>Note also that there have been no payouts &gt;100% of total sales, which means that Singapore Pools have never experienced the “strong” definition of loss in any draw. By this definition of loss, Singapore Pools (a.k.a. “the House”) has indeed always won.</p>
<p><strong>Year-on-Year Income</strong></p>
<p>Thus far we have been analysing the dataset per-draw, whereas corporate accounting typically analyses the income on an annual basis.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 9.png" class="img-fluid figure-img"></p>
<figcaption>Year-on-year actual vs expected income for Singapore Pools</figcaption>
</figure>
</div>
<p>In this figure, we see Singapore Pools’ actual income versus expected income (45% of total sales) for each full year, from 2015 to 2025. The difference between actual and expected income is also plotted in the red lineplot. 7 out of the 10 years assessed showed lower-than-expected income, indicating weak loss.</p>
</section>
<section id="conditions-for-strong-loss" class="level3">
<h3 class="anchored" data-anchor-id="conditions-for-strong-loss">Conditions for “Strong” Loss</h3>
<p>From analysis of the data, we now know that total payouts have never exceeded total sales per draw - Singapore Pools have never experienced a strong loss. But could it though? Are there conditions that increase the probability of a strong loss occurring?</p>
<p>Recall that the condition for a strong loss is expressed as:</p>
<p><span class="math display">\[
\sum_{i=1}^7 \text{payout}_i &gt; N
\]</span></p>
<p>Where <span class="math inline">\(N\)</span> is ticket sales ($1 per ticket), and <span class="math inline">\(i\)</span> represents the prize group number.</p>
<p>Since groups 1 to 4 prizes are defined as a function of the prize pool, payouts will never exceed the allocation (ignoring the $1M topup rule for simplicity).</p>
<p>It thus falls to groups 5 to 7 with fixed prizes to win more than their allocation, expressed as:</p>
<p><span class="math display">\[
\sum_{i=5}^7 \text{payout}_i &gt; N -\sum_{i=1}^4 \text{payout}_i
\]</span></p>
<p><span class="math display">\[
\sum_{i=5}^7 \text{payout}_i &gt; N -(N\times 0.545 \times 0.545)
\]</span></p>
<p><span class="math display">\[
\sum_{i=5}^7 \text{payout}_i &gt; 0.703N
\]</span></p>
<p>Lets re-write <span class="math inline">\(\text{payout}_i\)</span> to be more explicit.</p>
<p><span class="math display">\[
50W_5 + 25W_6 + 10W_7 &gt; 0.703N
\]</span></p>
<p>Where <span class="math inline">\(W_i\)</span> represents the number of winning tickets per group <span class="math inline">\(i\)</span>, multiplied by the fixed prize payouts for each group.</p>
<p>We should also note that <span class="math inline">\(W_i=X_1 + X_2 + \dots + X_N\)</span>, where each <span class="math inline">\(X_k \in [0,1]\)</span> is an indicator variable on whether ticket <span class="math inline">\(k\)</span> has won in group <span class="math inline">\(i\)</span>. This implies that <span class="math inline">\(X_k\)</span> is a Bernoulli random variable, and <span class="math inline">\(W_i\)</span> thus follows a Binomial distribution.</p>
<p>But if <span class="math inline">\(N\)</span> is large enough, then Central Limit Theorem allows us to treat <span class="math inline">\(W_i\)</span> as normally distributed! The rule of thumb here is <span class="math inline">\(Np\geq 10\)</span> and <span class="math inline">\(N(1-p)\geq 10\)</span>. Lets check this.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Group <span class="math inline">\(i\)</span></th>
<th>Lowest recorded <span class="math inline">\(N\)</span></th>
<th><span class="math inline">\(p_i=P(Win_i)\)</span></th>
<th><span class="math inline">\(Np_i\)</span></th>
<th><span class="math inline">\(N(1-p_i)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
<td>4048473</td>
<td>0.00092357</td>
<td>3739</td>
<td>4044733</td>
</tr>
<tr class="even">
<td>6</td>
<td>4048473</td>
<td>0.00123142</td>
<td>4985</td>
<td>4043487</td>
</tr>
<tr class="odd">
<td>7</td>
<td>4048473</td>
<td>0.01641898</td>
<td>66471</td>
<td>3982001</td>
</tr>
</tbody>
</table>
<p>Since <span class="math inline">\(Np &gt;&gt;10\)</span> and <span class="math inline">\(N(1-p) &gt;&gt; 10\)</span>, it’s safe to proceed with Central Limit Theorem!</p>
<p><span class="math inline">\(W_i\)</span> is approximately normal, with mean <span class="math inline">\(\mu_i=\mathbb{E}[Win_i]\)</span> and variance <span class="math inline">\(\sigma_i^2=Np_i(1-p_i)\)</span>.</p>
<p>And by extension, fixed prize payouts <span class="math inline">\(50W_5 + 25W_6 + 10W_7\)</span> are also normally distributed, with mean <span class="math inline">\(\mu=\sum_{i=5}^7\mathbb{E}[Win_i]\)</span> and variance <span class="math inline">\(\sigma^2=\sum_{i=5}^7Np_i(1-p_i)\)</span>.</p>
<p>Lets expand the terms.</p>
<p><span class="math display">\[
\mu = 50Np_5 + 25Np_6 + 10Np_7 = 0.241N
\]</span></p>
<p><span class="math display">\[
\sigma^2 = 50^2Np_5(1-p_5)+25^2Np_6(1-p_6) + 10^2Np_7(1-p_7) = 4.69N
\]</span></p>
<p><span class="math display">\[
\sigma=\sqrt{\sigma^2}=2.17\sqrt{N}
\]</span></p>
<p>Having approximated the fixed price payouts as normally distributed, we can find the Z-score via conversion to a <em>standard</em> normal distribution. The strong loss threshold we are looking at is <span class="math inline">\(0.703N\)</span>, which converts to the Z-threshold as <span class="math inline">\(\frac{0.703N-\mu}{\sigma} = 0.213\sqrt{N}\)</span></p>
<p>To be clear, we have made the equivalence that <span class="math inline">\(P(payout &gt; 0.703N) = P(Z &gt; 0.213\sqrt{N})\)</span></p>
<p><strong>What’s the probability of strong loss occurring?</strong></p>
<p>Well, it depends. In the following figure we plot the probability <span class="math inline">\(P(Z &gt; 0.213\sqrt{N})\)</span> for varying values of <span class="math inline">\(N\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 10.png" class="img-fluid figure-img"></p>
<figcaption>Probability of strong loss occurring as a function of ticket sales</figcaption>
</figure>
</div>
<p>Note that the probability of a strong loss occurring increases as ticket sales decreases. This probability drops below 5% after 60 tickets have been sold, and below 1% after 120 tickets. That’s a “sure win” for Singapore Pools to me.</p>
<p>But wait! How is it that when ticket sales are <em>smaller</em>, there’s a <em>higher</em> probability of Singapore Pools suffering a strong loss? That’s confusing.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 11.png" class="img-fluid figure-img"></p>
<figcaption><em>credit: Crystal_ YouTube</em></figcaption>
</figure>
</div>
<p>But here’s the thing: Singapore Pools suffers a strong loss as a proportion of <span class="math inline">\(N\)</span>.</p>
<p><span class="math display">\[
\text{Strong Loss Occurs} \rightarrow \text{Payout Groups 5 to 7} &gt; 0.703N
\]</span></p>
<p>Equivalently,</p>
<p><span class="math display">\[
\text{Payout Groups 5 to 7}/N &gt; 0.703
\]</span></p>
<p>The average payout for fixed prize groups just has to be larger than 70.3cents.</p>
<p>Note also that the standard deviation reduces as <span class="math inline">\(N\)</span> increases.</p>
<table class="caption-top table">
<caption>Standard deviation of fixed prize payouts by ticket sales</caption>
<thead>
<tr class="header">
<th><span class="math inline">\(N\)</span></th>
<th><span class="math inline">\(\sigma = 2.17\sqrt{N}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>100</td>
<td>$0.217</td>
</tr>
<tr class="even">
<td>10,000</td>
<td>$0.0217</td>
</tr>
<tr class="odd">
<td>1,000,000</td>
<td>$0.00068</td>
</tr>
</tbody>
</table>
<p>So the “spread” about the mean actually reduces when <span class="math inline">\(N\)</span> is large, meaning it gets harder to achieve that 70.3 cents per ticket payout. That’s some 200IQ play, Singapore Pools.</p>
</section>
</section>
<section id="so-when-does-the-house-lose" class="level2">
<h2 class="anchored" data-anchor-id="so-when-does-the-house-lose">So, When Does the House Lose?</h2>
<p>You can make this happen! <em>Don’t <del>pray</del> play to the TOTO god.</em> When ticket sales are low enough, there is (A) a certainty that Singapore Pools will have to top up the group 1 prize, and (B) a greater chance that fixed prize payouts exceed the total prize pool.</p>
<p>Will this ever happen? I doubt so. Even if ticket sales are abnormally low, Singapore Pools can top up the prize pool (to beyond $1M), thus incentivising more players into the draw and stacking the odds in their favour.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>We have confirmed from historical data that TOTO is a fair lottery game, and that Singapore Pools never truly loses. Also, the Tote Board does use gaming surplus for social good, turning gambling into a form of capital reallocation for social equity does warm the cockles of my heart.</p>
<p>This was a fun game and dataset to analyse. Further extension of this work could take the form of “what-if” analyses, potentially tuning payout amounts to optimise for income. Exploring lottery rule changes might be interesting too, inspired by <a href="https://highline.huffingtonpost.com/articles/en/lotto-winners/">this Cash WinFall rolldown story</a>. If you’re interested in a real-world group of people beating the odds, it’s a great read. Thanks for your time!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/image 12.png" class="img-fluid figure-img"></p>
<figcaption><em>credit: memegenerator.net</em></figcaption>
</figure>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>